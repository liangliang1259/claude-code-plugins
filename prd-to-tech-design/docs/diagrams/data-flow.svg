<?xml version="1.0" encoding="UTF-8"?>
<svg width="1400" height="900" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif; font-size: 28px; font-weight: bold; fill: #333; }
      .label { font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif; font-size: 16px; fill: #333; }
      .small-label { font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif; font-size: 13px; fill: #666; }
      .step-num { font-family: 'Arial', sans-serif; font-size: 20px; font-weight: bold; fill: #fff; }
      .box { stroke: #333; stroke-width: 2; }
      .arrow { stroke: #666; stroke-width: 2.5; fill: none; marker-end: url(#arrowhead); }
      .process-box { fill: #e3f2fd; stroke: #1976d2; }
      .decision-box { fill: #fff3e0; stroke: #ff9800; }
      .data-box { fill: #e8f5e9; stroke: #4caf50; }
      .output-box { fill: #f3e5f5; stroke: #9c27b0; }
    </style>
    <marker id="arrowhead" markerWidth="12" markerHeight="12" refX="10" refY="4" orient="auto">
      <polygon points="0 0, 12 4, 0 8" fill="#666" />
    </marker>
  </defs>

  <!-- 背景 -->
  <rect width="1400" height="900" fill="#f8f9fa"/>

  <!-- 标题 -->
  <text x="700" y="50" text-anchor="middle" class="title">PRD转技术方案 - 数据流程图</text>

  <!-- 步骤1：输入 -->
  <circle cx="120" cy="150" r="25" fill="#1976d2"/>
  <text x="120" y="158" text-anchor="middle" class="step-num">1</text>

  <rect x="170" y="110" width="300" height="80" class="box process-box" rx="5"/>
  <text x="320" y="140" text-anchor="middle" class="label" font-weight="bold">用户输入PRD</text>
  <text x="320" y="165" text-anchor="middle" class="small-label">选择输入方式</text>

  <!-- 输入选项 -->
  <rect x="520" y="80" width="150" height="50" class="box data-box" rx="5"/>
  <text x="595" y="110" text-anchor="middle" class="label">本地文件</text>

  <rect x="520" y="140" width="150" height="50" class="box data-box" rx="5"/>
  <text x="595" y="170" text-anchor="middle" class="label">飞书导出</text>

  <rect x="520" y="200" width="150" height="50" class="box data-box" rx="5"/>
  <text x="595" y="230" text-anchor="middle" class="label">飞书API</text>

  <line x1="470" y1="150" x2="520" y2="105" class="arrow"/>
  <line x1="470" y1="150" x2="520" y2="165" class="arrow"/>
  <line x1="470" y1="150" x2="520" y2="225" class="arrow"/>

  <!-- 步骤2：解析 -->
  <circle cx="820" cy="150" r="25" fill="#1976d2"/>
  <text x="820" y="158" text-anchor="middle" class="step-num">2</text>

  <rect x="870" y="110" width="280" height="80" class="box process-box" rx="5"/>
  <text x="1010" y="140" text-anchor="middle" class="label" font-weight="bold">PRD解析器</text>
  <text x="1010" y="165" text-anchor="middle" class="small-label">prd_parser.py 提取结构化数据</text>

  <line x1="670" y1="150" x2="820" y2="150" class="arrow"/>

  <!-- 步骤3：PRD分析Agent -->
  <circle cx="120" cy="350" r="25" fill="#1976d2"/>
  <text x="120" y="358" text-anchor="middle" class="step-num">3</text>

  <rect x="170" y="300" width="350" height="100" class="box process-box" rx="5"/>
  <text x="345" y="335" text-anchor="middle" class="label" font-weight="bold">PRD分析Agent</text>
  <text x="345" y="360" text-anchor="middle" class="small-label">提取功能需求、用户故事、约束</text>
  <text x="345" y="380" text-anchor="middle" class="small-label">识别技术影响和风险</text>

  <line x1="1010" y1="190" x2="1010" y2="350" class="arrow"/>
  <line x1="1010" y1="350" x2="870" y2="350" class="arrow"/>

  <!-- 分析结果 -->
  <rect x="570" y="300" width="250" height="100" class="box data-box" rx="5"/>
  <text x="695" y="335" text-anchor="middle" class="label" font-weight="bold">结构化分析数据</text>
  <text x="695" y="360" text-anchor="middle" class="small-label">• 需求清单 (FR/NFR)</text>
  <text x="695" y="380" text-anchor="middle" class="small-label">• 用户故事 (US)</text>
  <text x="695" y="400" text-anchor="middle" class="small-label">• 约束和风险</text>

  <line x1="520" y1="350" x2="570" y2="350" class="arrow"/>

  <!-- 步骤4：技术方案生成Agent -->
  <circle cx="970" cy="350" r="25" fill="#1976d2"/>
  <text x="970" y="358" text-anchor="middle" class="step-num">4</text>

  <rect x="1020" y="300" width="320" height="100" class="box process-box" rx="5"/>
  <text x="1180" y="335" text-anchor="middle" class="label" font-weight="bold">技术方案生成Agent</text>
  <text x="1180" y="360" text-anchor="middle" class="small-label">基于分析数据和模板</text>
  <text x="1180" y="380" text-anchor="middle" class="small-label">生成完整技术设计文档</text>

  <line x1="820" y1="350" x2="1020" y2="350" class="arrow"/>

  <!-- 步骤5：模板填充 -->
  <circle cx="120" cy="550" r="25" fill="#1976d2"/>
  <text x="120" y="558" text-anchor="middle" class="step-num">5</text>

  <rect x="170" y="500" width="300" height="100" class="box process-box" rx="5"/>
  <text x="320" y="535" text-anchor="middle" class="label" font-weight="bold">应用技术设计模板</text>
  <text x="320" y="560" text-anchor="middle" class="small-label">tech_design_template.md</text>
  <text x="320" y="580" text-anchor="middle" class="small-label">填充8个章节内容</text>

  <line x1="1180" y1="400" x2="1180" y2="550" class="arrow"/>
  <line x1="1180" y1="550" x2="470" y2="550" class="arrow"/>

  <!-- 步骤6：生成图表 -->
  <circle cx="620" cy="550" r="25" fill="#1976d2"/>
  <text x="620" y="558" text-anchor="middle" class="step-num">6</text>

  <rect x="670" y="500" width="400" height="100" class="box process-box" rx="5"/>
  <text x="870" y="530" text-anchor="middle" class="label" font-weight="bold">生成Mermaid图表</text>
  <text x="870" y="555" text-anchor="middle" class="small-label">• 系统架构图 • ER图 • 流程图</text>
  <text x="870" y="575" text-anchor="middle" class="small-label">• 部署架构图 • 甘特图 • 时序图</text>

  <line x1="470" y1="550" x2="670" y2="550" class="arrow"/>

  <!-- 步骤7：输出文档 -->
  <circle cx="120" cy="750" r="25" fill="#1976d2"/>
  <text x="120" y="758" text-anchor="middle" class="step-num">7</text>

  <rect x="170" y="700" width="1100" height="120" class="box output-box" rx="5"/>
  <text x="720" y="735" text-anchor="middle" class="label" font-weight="bold">输出技术设计文档</text>

  <text x="250" y="770" text-anchor="middle" class="small-label">1. 功能概述</text>
  <text x="400" y="770" text-anchor="middle" class="small-label">2. 技术栈选型</text>
  <text x="550" y="770" text-anchor="middle" class="small-label">3. 核心模块设计</text>
  <text x="700" y="770" text-anchor="middle" class="small-label">4. 数据库设计</text>
  <text x="850" y="770" text-anchor="middle" class="small-label">5. API设计</text>
  <text x="1000" y="770" text-anchor="middle" class="small-label">6. 部署架构</text>
  <text x="1150" y="770" text-anchor="middle" class="small-label">7. 风险评估</text>
  <text x="1250" y="770" text-anchor="middle" class="small-label">8. 开发计划</text>

  <text x="350" y="800" text-anchor="middle" class="small-label" fill="#666">所有章节 • Mermaid图表 • 中文内容</text>

  <line x1="870" y1="600" x2="870" y2="750" class="arrow"/>
  <line x1="870" y1="760" x2="1270" y2="760" class="arrow"/>

  <!-- 保存位置 -->
  <rect x="170" y="840" width="500" height="40" fill="#e8f5e9" stroke="#4caf50" class="box" rx="5"/>
  <text x="420" y="865" text-anchor="middle" class="label">保存至: outputs/YYYY/MM-DD/tech-design-{功能名}-{时间戳}.md</text>

  <line x1="720" y1="820" x2="720" y2="840" class="arrow"/>

  <!-- 图例 -->
  <rect x="1100" y="80" width="250" height="180" fill="#fff" stroke="#333" class="box" rx="5"/>
  <text x="1225" y="105" text-anchor="middle" class="label" font-weight="bold">图例</text>

  <rect x="1120" y="120" width="30" height="20" fill="#e3f2fd" stroke="#1976d2"/>
  <text x="1160" y="135" class="small-label">处理步骤</text>

  <rect x="1120" y="150" width="30" height="20" fill="#e8f5e9" stroke="#4caf50"/>
  <text x="1160" y="165" class="small-label">数据</text>

  <rect x="1120" y="180" width="30" height="20" fill="#f3e5f5" stroke="#9c27b0"/>
  <text x="1160" y="195" class="small-label">输出</text>

  <circle cx="1135" cy="220" r="10" fill="#1976d2"/>
  <text x="1135" y="224" text-anchor="middle" font-size="12" fill="#fff" font-weight="bold">N</text>
  <text x="1160" y="225" class="small-label">步骤编号</text>

</svg>
